# Нагрузочное тестирование с помощью Locust

## Виртуальное окружение

Рекомендуется запускать Locust из виртуального окружения Python.

### Создание окружения (один раз)

В корне проекта:

```powershell
python -m venv venv
```

### Активация окружения (Windows / PowerShell)

```powershell
.\venv\Scripts\Activate.ps1
```

После активации в начале приглашения появится префикс `(venv)`.

### Установка зависимостей (включая Locust)

```powershell
pip install -r requirements.txt
```

В `requirements.txt` добавлен пакет `locust`.

## Сценарии Locust

Основной файл сценария:

- `load_tests/locustfile.py`

В нём описан пользователь `TeamsUser`, который обращается к эндпоинту:

- `GET /api/teams/<id>/`

Список ID команд задаётся через переменную окружения `LOCUST_TEAM_IDS`.

Пример:

```powershell
$env:LOCUST_TEAM_IDS = "id1,id2,id3"
```

ID должны быть строками UUID, соответствующими существующим командам.

## Запуск Locust

Предполагается, что Django‑сервер запущен локально на `http://localhost:8000`.

### Запуск с веб‑интерфейсом (локально)

```powershell
locust -f load_tests/locustfile.py --host=http://localhost:8000
```

После запуска откройте браузер по адресу:

- `http://localhost:8089`

Там можно задать:

- количество пользователей (Number of users);
- скорость их появления (Spawn rate).

### Headless‑режим (без веб‑интерфейса)

Пример запуска 50 пользователей с появлением по 5 пользователей в секунду в течение 2 минут:

```powershell
locust -f load_tests/locustfile.py ^
  --host=http://localhost:8000 ^
  --headless ^
  -u 50 ^
  -r 5 ^
  --run-time 2m
```

## Тестирование удалённого стенда

Для нагрузочного тестирования удалённого стенда укажите соответствующий `--host`, например:

```powershell
locust -f load_tests/locustfile.py --host=https://your-staging-url
```

Рекомендуется:

- начинать с малого числа пользователей и низкого `spawn rate`;
- согласовать нагрузку с командой, ответственной за стенд;
- мониторить ресурсы БД и приложения во время теста.

## Интерпретация результатов

В отчётах Locust обратите внимание на:

- **RPS (Requests per second)** — общее количество запросов в секунду;
- **Среднее время отклика** и **95‑й перцентиль (95%ile)**;
- **Процент ошибок** (ошибки HTTP, таймауты, проблемы с JSON‑ответом).

Рост задержек и ошибок при увеличении числа пользователей помогает выявить узкие места в производительности.

